from paddleocr import PaddleOCR, draw_ocr  # main OCR dependencies
from matplotlib import pyplot as plt  # plot images
import cv2  # opencv
import os  # folder directory navigation

# Setup model
ocr_model = PaddleOCR(lang='en')

img_path = os.path.join('.', 'img', 'test.jpg')

# Run the ocr method on the ocr model
result = ocr_model.ocr(img_path)

# Specify the output directory and file path
output_dir = r'C:\Users\USER\Desktop\code\c++\ocr_paddle\bmp'
output_file = os.path.join(output_dir, 'ocr_result.txt')

# Ensure the output directory exists
os.makedirs(output_dir, exist_ok=True)

# Extract and save the text and confidence scores to a text file
with open(output_file, 'w', encoding='utf-8') as f:
    for res in result:
        for line in res:
            text_confidence_tuple = line[1]
            f.write(f"('{text_confidence_tuple[0]}', {text_confidence_tuple[1]})\n")

# Print to terminal for verification
for res in result:
    for line in res:
        print(f"('{line[1][0]}', {line[1][1]})")

# Optional: visualize the result using draw_ocr
# img = cv2.imread(img_path)
# boxes = [line[0] for line in result[0]]
# txts = [line[1][0] for line in result[0]]
# scores = [line[1][1] for line in result[0]]
# im_show = draw_ocr(img, boxes, txts, scores, font_path='path/to/your/font.ttf')
# im_show = cv2.cvtColor(im_show, cv2.COLOR_BGR2RGB)
# plt.imshow(im_show)
# plt.show()
